<!DOCTYPE html>
<html lang='en'>
   <head>
      <meta charset='UTF-8'>
      <title>Tree-js</title>
   </head>
   <body>
    <div id='root'></div>
    <script type='text/javascript'>
    closeHandler = (close_button ) => {
      const ul = close_button.parentNode.nextSibling;
      if(close_button.innerHTML =='CLOSE'){
        close_button.innerHTML = 'OPEN';
        ul.style.display = 'none';
        return;
      }
      if(close_button.innerHTML =='OPEN') {
        close_button.innerHTML = 'CLOSE';
        ul.style.display = 'block';
        return;
      }
    }
    addHandler = (add_button, i, ul) => {
      const close_button = add_button.nextSibling;
      const _name = add_button.previousSibling.innerHTML;
      const li = close_button.parentNode.parentNode;
        if(close_button.disabled) {
          li.appendChild(ul);
          close_button.disabled = false;
        }
        ul.appendChild(createNode(`${_name}${i++}`, close_button));
      }
    removeHandler = (remove_button, parent_close_button) => {
      const node_li = remove_button.parentNode.parentNode;
      const parent = node_li.parentNode;
      const siblings = parent.getElementsByTagName('li');
      if(siblings.length == '1') parent_close_button.disabled = true;
      node_li.remove();
    }
    createRoot = (name) => {
      const root_li = document.createElement('li');
      const root_div = document.createElement('div');
      root_li.appendChild(root_div);
      const root_name = document.createElement('h3');
      root_name.innerHTML = name;
      root_div.appendChild(root_name);
      const root_close_button = document.createElement('button');
      root_close_button.innerHTML = 'CLOSE';
      root_close_button.disabled = true;
      root_close_button.addEventListener('click', () => closeHandler(root_close_button));
      const root_add_button = document.createElement('button');
      root_add_button.innerHTML = 'ADD';
      const root_ul = document.createElement('ul');
      let i = 0;
      root_add_button.addEventListener('click', () => addHandler(root_add_button, i++, root_ul));
      root_div.appendChild(root_add_button);
      root_div.appendChild(root_close_button);
      return [root_li,root_div];
    }
    createNode = (name, close_button) => {
      const node = createRoot(name);
      const node_li = node[0];
      const node_div = node[1];
      const node_remove_button = document.createElement('button');
      node_remove_button.innerHTML = 'REMOVE';
      node_remove_button.addEventListener('click',() => removeHandler(node_remove_button, close_button));
      node_div.appendChild(node_remove_button);
      return node_li;
    }
    const container = document.getElementById('root');
    const container_ul = document.createElement('ul');
    const container_li = createRoot('Tree')[0];
    container_ul.appendChild(container_li);
    container.appendChild(container_ul);
    </script>
  </body>
</html>
